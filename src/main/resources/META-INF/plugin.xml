<?xml version="1.0" encoding="UTF-8"?>
<idea-plugin>
    <id>dev.example.security-marker</id>
    <name>Security Critical Method Marker</name>
    <vendor email="ranjith.krishnamurthy@iem.fraunhofer.de">Ranjith K</vendor>
    <description>
        Security critical marker and explanation to assist developers pro-actively
    </description>


    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.java</depends>
    <depends>org.jetbrains.kotlin</depends>


    <applicationListeners>
        <listener class="de.fraunhofer.iem.listeners.FileChangeListener"
                  topic="com.intellij.openapi.vfs.newvfs.BulkFileListener"/>
    </applicationListeners>

    <actions>
        <!-- Top-level popup menu -->
        <group id="de.fraunhofer.iem.SecurityMarkerMenu"
               text="Security Marker"
               popup="true"
               class="de.fraunhofer.iem.actions.SecurityMarkerActionGroup">
            <add-to-group group-id="MainMenu" anchor="last"/>
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
        </group>

        <!-- Refresh action -->
        <action id="de.fraunhofer.iem.RefreshSignatures"
                class="de.fraunhofer.iem.actions.RefreshSignaturesAction"
                text="Refresh"
                description="Regenerate the security-critical method list"/>
        
        <!-- Toggle Low Level Explanations action -->
        <action id="de.fraunhofer.iem.ShowLowLevelExplanations"
                class="de.fraunhofer.iem.actions.ShowLowLevelExplanationsAction"
                text="Show Low Level Explanations"
                description="Toggle display of explanations for Low level methods"/>
        
        <!-- Toggle Auto Refresh action -->
        <action id="de.fraunhofer.iem.ToggleAutoRefresh"
                class="de.fraunhofer.iem.actions.ToggleAutoRefreshAction"
                text="Auto Refresh on Save"
                description="Toggle automatic refresh when files are saved"/>
    </actions>


    <extensions defaultExtensionNs="com.intellij">
        <codeInsight.lineMarkerProvider language="JAVA" implementationClass="de.fraunhofer.iem.SecurityMarker"/>
        <codeInsight.lineMarkerProvider language="kotlin" implementationClass="de.fraunhofer.iem.SecurityMarker"/>
        <projectService serviceImplementation="de.fraunhofer.iem.metricsUtil.SignatureService"/>
        <applicationService serviceImplementation="de.fraunhofer.iem.Settings"/>
        <projectService serviceInterface="de.fraunhofer.iem.metricsUtil.CriticalMethodGenerator" serviceImplementation="de.fraunhofer.iem.metricsUtil.DefaultCriticalMethodGenerator"/>
        <projectService serviceImplementation="de.fraunhofer.iem.metricsUtil.MethodSignatureCacheService"/>
        <projectService serviceImplementation="de.fraunhofer.iem.cache.PersistentCacheService"/>
        <notificationGroup id="SecurityMarkerNotifications"
                           displayType="BALLOON"
                           isLogByDefault="true"
                           toolWindowId="Event Log"/>

        <!-- Annotators must be registered per language -->
        <annotator language="JAVA"   implementationClass="de.fraunhofer.iem.annotators.SecurityMethodAnnotator"/>
        <annotator language="kotlin" implementationClass="de.fraunhofer.iem.annotators.KotlinSecurityMethodAnnotator"/>
    </extensions>
</idea-plugin>